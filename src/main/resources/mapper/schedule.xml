<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kcc.trioffice.domain.schedule.mapper.ScheduleMapper">


  <select id="getEmployeeSchedules" parameterType="map" resultType="com.kcc.trioffice.domain.schedule.dto.EmployeeSchedules">
    SELECT
      name
      ,started_dt AS startedDt
      ,ended_dt AS endedDt
      FROM schedule
      WHERE schedule_id
        IN (
             SELECT i.SCHEDULE_INVITE_ID AS scheduleInviteId
               FROM schedule_invite i
               WHERE is_participated = 2 and employee_id =
                 (
                   SELECT employee_id
                     FROM employee
                     WHERE email = #{employeeId}
                 )
           )
        AND started_dt <![CDATA[>]]> ADD_MONTHS(TO_DATE(#{startDate}, 'YYYY-MM-DD'), -1)
        AND ended_dt <![CDATA[<=]]> ADD_MONTHS(TO_DATE(#{endDate}, 'YYYY-MM-DD'), 1)
  </select>

</mapper>

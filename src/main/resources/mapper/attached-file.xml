<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kcc.trioffice.domain.attached_file.mapper.AttachedFileMapper">

    <insert id="saveAttachedFile" parameterType="map">
        <selectKey keyProperty="s3UploadFile.fileId" resultType="long" order="BEFORE">
            SELECT SEQ_ATTACHED_FILE.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO attached_file (
            file_id,
            chat_id,
            file_url,
            file_type,
            file_name,
            file_volume,
            filename_extension,
            writer,
            write_dt,
            modifier,
            modified_dt,
            is_deleted
        )
        VALUES (
            #{s3UploadFile.fileId},
            #{chatId},
            #{s3UploadFile.fileUrl},
            #{s3UploadFile.fileType},
            #{s3UploadFile.fileName},
            #{s3UploadFile.fileSize},
            #{s3UploadFile.fileExtension},
            #{employeeId},
            SYSDATE,
            #{employeeId},
            SYSDATE,
            0
        )
    </insert>

    <select id="getAttachedFileByChatId" resultType="com.kcc.trioffice.global.image.dto.response.S3UploadFile">
        SELECT
            file_name AS fileName,
            file_url AS fileUrl,
            filename_extension AS fileExtension,
            file_volume AS fileSize,
            file_type AS fileType,
            file_id AS fileId
        FROM attached_file
        WHERE chat_id = #{chatId}
    </select>

</mapper>